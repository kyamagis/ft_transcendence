# JavaScriptのガベージコレクション

作成者: FukumaNaoya
最終更新日時: 2023年7月11日 22:11

ガベージコレクション（GC）は、プログラムが動的に確保したメモリのうち、もはや使用されていない部分を自動的に解放する仕組みです。これにより、開発者が手動でメモリの解放を管理する必要がなくなり、メモリリークのリスクが低減されます。

JavaScriptのようなガベージコレクションをサポートする言語では、ガベージコレクションは通常、ランタイムシステムの一部として動作します。これは通常、JavaScriptエンジン（ブラウザやNode.jsなど）の一部です。したがって、通常は別プロセスとしては動作しません。

C++のデストラクタとガベージコレクションは、共にメモリを解放するための手段ではありますが、それらは動作と管理の方法が大きく異なります。C++のデストラクタは、オブジェクトがスコープを抜けたときに自動的に呼び出されます。これに対して、ガベージコレクションは、オブジェクトがもはやどこからも参照されていないと判断されたときにメモリを解放します。

JavaScriptのガベージコレクションは主にマークアンドスイープ（mark-and-sweep）アルゴリズムを用いて動作します。このアルゴリズムでは、一定の間隔でガベージコレクションが実行され、その際に以下の2つのステップが行われます：

1. マーク（Mark）：ルートから到達可能なオブジェクトすべてにマークをつける。ルートとはグローバルオブジェクトやスタック上のローカル変数、その他の重要なリソースなど、システムが保持する参照のことです。
2. スイープ（Sweep）：マークがつけられていない（つまりルートから到達不可能な）オブジェクトをメモリから解放する。

したがって、参照の数を直接数えるわけではなく、到達可能性（reachable）に基づいてガベージコレクションが行われます。しかし、一部のガベージコレクションシステムでは参照カウントを利用する方法も用いられます。これはオブジェクトへの具体的な参照数を追跡し、その数がゼロになったときにそのオブジェクトを解放します。ただし、この方法は循環参照の問題を引き起こす可能性があるため、通常はマークアンドスイープ方式が主流です。