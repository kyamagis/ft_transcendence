# JavaScriptエンジン

作成者: FukumaNaoya
最終更新日時: 2023年7月10日 15:32

**JavaScriptエンジン**は、JavaScriptのコードを読み取り、それを低レベルのマシンコードにコンパイルまたはインタープリート（直訳）します。このマシンコードは、実際にコンピュータのプロセッサで実行できるものです。V8（Google ChromeやNode.jsで使われている）、SpiderMonkey（Firefoxで使われている）、JavaScriptCore（Safariで使われている）などがJavaScriptエンジンの例です。

JavaScriptエンジンは、ブラウザやNode.jsなどの実行環境において、JavaScriptのコードを読み込み、解釈し、実行する役割を担っています。

具体的な実行の過程は以下のようになります。

1. **字句解析(Lexical Analysis)**: JavaScriptコードは文字列として入力され、この段階で「トークン」（つまり、意味を持つ最小の単位）に分割されます。例えば、`var x = 10;`というコードは、"var"、"x"、"="、"10"、";"のようなトークンに分割されます。
2. **構文解析(Parsing)**: トークンは構文解析器（パーサ）によって「抽象構文木(AST: Abstract Syntax Tree)」に変換されます。ASTはプログラムの構造をツリー型のデータ構造で表現します。
3. **コンパイル(Compilation)**: ASTはバイトコードや中間言語に変換されます。これは機械語ではなく、一種の抽象的なコードで、これによってプログラムはより高速に実行できる形に変換されます。
4. **実行(Execution)**: 最終的に、このバイトコードや中間言語がエンジンによって実行されます。この段階では最適化が行われ、実際のハードウェアで実行されるための機械語に変換されます。

この一連の流れは、JavaScriptエンジンが動作しているプロセス内部で行われます。そして、最近のJavaScriptエンジン（例えばGoogleのV8エンジン）では、「JIT(Just In Time)コンパイル」というテクニックが用いられています。JITコンパイルでは、プログラムの実行と並行してコンパイルが行われるため、実行速度の向上が期待できます。

また、最適化のためにいくつかのテクニックが使われます。例えば、同じコードが何度も実行される場合（ループなど）、エンジンはその部分を機械語に直接コンパイルしてキャッシュし、次回からはそのキャッシュを利用することで高速化を図ります。これを「ホットコード」と言います。ただし、この最適化は状況により逆転することもあるため、「デオプティマイズ」（最適化の取り消し）という処理も存在します。

このように、JavaScriptエンジンは単にコードを読み込み、解釈し、実行するだけではなく、高速な実行を可能にするためのさまざまな工夫を行っています。